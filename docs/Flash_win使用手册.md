---
author: 林
title: Flash_win使用手册
---

# Windows 平台使用说明

项目代码详见 [Flash-yolo](https://github.com/vge-photogrammetry/flash-yolo/tree/master),Flash 软件包含用户注册程序、Flash 主程序、labelme 预测结果查看程序。

## Ⅰ 用户注册

在 cmd 中运行用户注册程序 admin.exe，输入下列命令获取 Machine GUID 与 Expected license file path（预期许可证放置位置）

```base
admin.exe show-guid
```

命令输出结果应如下格式所示

    Machine GUID: 796a8f98-a821-4874-b588-c9d5e9f80423
    Expected license file path: C:\Users\10750\AppData\Local\Flash\flash_license.dat

将 Machine GUID 复制发给软件负责人用于注册，获得许可(文件名应为 flash_license.dat)后，将该许可放于预期许可证放置位置

许可证放置完成后，cmd 运行下列命令检测许可是否生效

    admin.exe status

<!---->

    Message: License is valid #输出有这行命令，证明许可有效

如需更多信息，运行下列代码

    admin.exe --help

## Ⅱ Flash 主程序

Flash 主程序包含了下列工具 1.预测，2.聚类，3.图像聚类， 4.重建， 5.路损评估， 6.自动路损评估， 7.DOM 全局路损评估。

其中 聚类与图像聚类为同一步骤不同方法；路损评估、自动路损评估、DOM 全局路损评估为同一步骤不同方法。

**程序主要流程为：预测 → 聚类/图像聚类 → 重建 → 路损评估/自动路损评估/DOM 全局路损评估。**

程序最终会输出无人机所拍摄区域滑坡导致的路损情况报告（.pdf)

更多命令行功能请自行查找使用方法。

    flash.exe --help

### 预测

在输入目录处选择需要进行路损评估的无人机影像文件夹，选择权重文件。

设置图像大小：无人机影像进行预测时需要缩放到的大小，根据分辨率计算，公式为：长边像素数\*影像分辨率/0.5，像素分辨率单位为 m/pixel

设置置信度与 IoU 阈值，二者阈值越高，识别越严格

点选保存可视化图像可生成带色掩膜图像，高亮显示滑坡在影像中的位置

进行预测后，识别结果以 labelme 格式 json 文件保存在无人机影像文件夹下

![](imgs/24abcec0-9078-11f0-83af-83347a4aea8a.gif?v=1&type=image)
![](imgs/56694df0-9084-11f0-93c9-135a04ba4bf1.gif?v=1&type=image)

### 聚类

**预测** 程序执行后，输入目录选择无人机影像文件夹，设置聚类输出目录

聚类设置中，最小聚类数代表带个类中最少有多少个对象，聚类搜索数量代表每次进行特征匹配，进行匹配的影像数量

阈值设置中，阈值越高，聚类过程越严格

![](imgs/2d185510-9078-11f0-83af-83347a4aea8a.gif?v=1&type=image)
![](imgs/833a1530-9084-11f0-abd1-e5843182529d.gif?v=1&type=image)

### 聚类图像

输入目录设置为 \*\*预测 \*\*执行后的无人机影像文件夹，该功能实现按照无人机拍摄时序进行图像聚类，获取选取影像前后拍摄的 k 张影像作为聚类结果，在选择框中选择需要进行聚类的影像，设置最近邻居数量即聚类输出目录

![](imgs/3039ce70-907a-11f0-83af-83347a4aea8a.gif?v=1&type=image)
![](imgs/8f8694d0-9084-11f0-abd1-e5843182529d.gif?v=1&type=image)

### 重建

选择 \*\*聚类/聚类图像 \*\*生成聚类输出文件夹，在选择框中点选需要进行重建的滑坡

选择重建准确性，选择坐标参考系统（中国西部地区推荐采用默认 epsg32648 投影系）

![](imgs/73d8a380-907b-11f0-83af-83347a4aea8a.gif?v=1&type=image)
![](imgs/9d4f7b40-9084-11f0-abd1-e5843182529d.gif?v=1&type=image)

### 路损评估imgs

文件输入中，滑坡文件在重建过程中已自动生成，滑坡文件，道路文件需要人工进行勾勒。

设置中，插值步长代表道路沿线进行分析的采样密度，道路宽度代表需要进行路损评估的道路的宽度，由于滑坡可能产生地下水蚀，所以分析时需要扩大滑坡面积，滑坡缓冲区代表需要外扩的距离。定级阈值代表道路根据受掩埋宽度分为不同受灾等级的依据。

![](imgs/0355e270-907c-11f0-83af-83347a4aea8a.gif?v=1&type=image)
![](imgs/ba3cb970-9084-11f0-abd1-e5843182529d.gif?v=1&type=image)

### 自动路损评估

该功能与**路损评估功能**方法相近，目的相同，但无需人工勾勒道路，在文件夹输入与输出块，设置影像与标签文件夹（包含无人机影像及同名 json 文件），由**重建**功能生成的 DSM.tif，设置报告输出文件夹。

道路重建参数中，像素权重阈值代表栅格化后重叠的道路像素，重叠个数大于改值则保留。道路搜寻最大距离代表断路之间进行连接的最大距离，超出该距离则不进行连接。平滑控制因子代表道路连接线的平滑程度，值越大越平滑，需要进行分析的道路长度，受滑坡灾害影响的道路前后长度之和。生成道路骨架指为复杂道路生成精确复杂的骨架线，若不勾选，则直接使用包围盒中线作为道路线要素。
imgs
报告生成参数设置与**路损评估**功能想同

![](imgs/6edcc800-907d-11f0-83af-83347a4aea8a.gif?v=1&type=image)

![](imgs/c7c4ed60-9084-11f0-abd1-e5843182529d.gif?v=1&type=image)

### DOM 全局路损评估

该功能实现对输入 DOM 区域内所有滑坡路损进行分析，DOM.tif 文件需携带地理信息，不能大于 1G，否则显存无法支撑，模型文件选取与**预测**功能相同的模型文件，道路重建设置及报告生成参数设置与**自动路损评估**功能相同

![](imgs/53153330-907f-11f0-83af-83347a4aea8a.gif?v=1&type=image)
![](imgs/fcaacc20-9084-11f0-abd1-e5843182529d.gif?v=1&type=image)

## labelme 预测结果查看

直接双击 labelme.exe，可查看**预测**功能的结果

![](imgs/1b1c52a0-9080-11f0-83af-83347a4aea8a.gif?v=1&type=image)
![](imgs/6aa2a720-9085-11f0-abd1-e5843182529d.gif?v=1&type=image)
